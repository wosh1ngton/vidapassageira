<div class="registro-page">
  <p-toast></p-toast>

  <div class="registro-container">
    <div class="registro-header">
      <a routerLink="/" class="logo-link">
        <img src="assets/imagens/logo.png" alt="VidaPassageira" class="logo">
      </a>
      <h1 class="registro-title">Criar Conta</h1>
      <p class="registro-subtitle">Comece a planejar suas viagens dos sonhos</p>
    </div>

    <div class="registro-form-wrapper">
      <form #formSubmit="ngForm" (ngSubmit)="salvar()">
        <div class="p-fluid">
          <div class="field mb-4">
            <label for="username">Nome de usuário</label>
            <input
              id="username"
              class="w-full"
              pInputText
              name="username"
              [(ngModel)]="usuario.username"
              placeholder="Escolha um nome de usuário"
              required
              minlength="3"
              #usernameInput="ngModel" />
            <small class="field-hint" *ngIf="!usernameInput.errors">
              Mínimo de 3 caracteres
            </small>
            <small class="field-error" *ngIf="usernameInput.invalid && usernameInput.touched">
              <span *ngIf="usernameInput.errors?.['required']">Nome de usuário é obrigatório</span>
              <span *ngIf="usernameInput.errors?.['minlength']">Mínimo de 3 caracteres</span>
            </small>
          </div>

          <div class="field mb-4">
            <label for="email">Email</label>
            <input
              id="email"
              class="w-full"
              pInputText
              name="email"
              [(ngModel)]="usuario.email"
              type="email"
              placeholder="seu@email.com"
              required
              pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
              #emailInput="ngModel" />
            <small class="field-hint" *ngIf="!emailInput.errors">
              Digite um e-mail válido
            </small>
            <small class="field-error" *ngIf="emailInput.invalid && emailInput.touched">
              <span *ngIf="emailInput.errors?.['required']">E-mail é obrigatório</span>
              <span *ngIf="emailInput.errors?.['pattern']">E-mail inválido</span>
            </small>
          </div>

          <div class="field mb-4">
            <label for="password">Senha</label>
            <input
              id="password"
              class="w-full"
              pPassword
              name="password"
              [(ngModel)]="usuario.password"
              placeholder="Crie uma senha segura"
              required
              minlength="6"
              [feedback]="false"
              #passwordInput="ngModel" />
            <small class="field-hint" *ngIf="!passwordInput.errors">
              Mínimo de 6 caracteres
            </small>
            <small class="field-error" *ngIf="passwordInput.invalid && passwordInput.touched">
              <span *ngIf="passwordInput.errors?.['required']">Senha é obrigatória</span>
              <span *ngIf="passwordInput.errors?.['minlength']">Mínimo de 6 caracteres</span>
            </small>
          </div>

          <!-- Seção de Consentimentos LGPD -->
          <div class="consent-section mb-4">
            <h4 class="consent-title">
              <i class="pi pi-shield"></i>
              Consentimento e Privacidade
            </h4>

            <div class="consent-item required">
              <p-checkbox
                [(ngModel)]="usuario.termsAccepted"
                inputId="termsAccepted"
                name="termsAccepted"
                #termsCheckbox="ngModel">
              </p-checkbox>
              <label for="termsAccepted" class="consent-label">
                Li e aceito os <a href="/termos" target="_blank" class="consent-link">Termos de Uso</a>
                <span class="required-indicator">*</span>
              </label>
            </div>

            <div class="consent-item required">
              <p-checkbox
                [(ngModel)]="usuario.privacyAccepted"
                inputId="privacyAccepted"
                name="privacyAccepted"
                #privacyCheckbox="ngModel">
              </p-checkbox>
              <label for="privacyAccepted" class="consent-label">
                Li e aceito a <a href="/privacidade" target="_blank" class="consent-link">Política de Privacidade</a>
                <span class="required-indicator">*</span>
              </label>
            </div>

            <small class="consent-note">
              <i class="pi pi-info-circle"></i>
              Seus dados estão protegidos com HTTPS e seguem a LGPD (Lei Geral de Proteção de Dados).
            </small>
          </div>

          <div class="field mb-3">
            <p-button
              type="submit"
              label="Criar Conta"
              icon="pi pi-user-plus"
              [loading]="loading"
              [disabled]="!formSubmit.valid || !isConsentValid() || loading"
              styleClass="w-full">
            </p-button>
          </div>

          <div class="text-center">
            <p class="text-sm text-600 mb-2">Já tem uma conta?</p>
            <p-button
              type="button"
              label="Fazer Login"
              icon="pi pi-sign-in"
              severity="secondary"
              [outlined]="true"
              (onClick)="fazerLogin()"
              styleClass="w-full">
            </p-button>
          </div>
        </div>
      </form>
    </div>

    <div class="registro-footer">
      <p class="text-sm text-600">© 2026 VidaPassageira - Planeje viagens inesquecíveis</p>
    </div>
  </div>
</div>
